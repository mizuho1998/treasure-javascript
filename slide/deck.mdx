import {
	Split,
	SplitRight,
	Image,
} from 'mdx-deck'

import highlight from '@mdx-deck/themes/syntax-highlighter'
import provider from './component/provider'
import Header from './component/header'

export const theme = {
  ...highlight,
  ...provider,
  fonts: {
    body: 'Futura, sans-serif',
    monospace: '"Dank Mono", monospace;',
  },
  colors: {
    text: 'rgb(106, 215, 152)',
    background: 'rgb(1, 22, 39)',
    primary: 'white',
  },
  styles: {
    Slide: {
      display: 'block',
      padding: '1em',
      textAlign: 'left',
    },
  },
}

<Header>Uncaught TypeError: undefined is not a function</Header>

---

<Header>Join #frontend</Header>

---

<Header>去年のAPI講義のまとめ</Header>

- 公開APIではないときはRESTfulまで頑張らないこと
- URL設計はチーム内で共通意識
- https://twitter.com/Tockn_inthebox/status/1030020851704332288?s=20

---

<Header>JavaScript (web) </Header>

---

<Header>天地創造の歴史</Header>

---

<Header>大昔：天地創造</Header>

- 1日: 神は天と地をつくられた
- 2日: 神は空（天）をつくられた
- 3日: 神は大地を作り海が生まれ地に植物をはえさられた
- 4日: 神は太陽と月と星をつくられた
- 5日: 神は魚と鳥をつくられた
- 6日: 神は獣と家畜をつくり、神に似せた人をつくられた
- 7日: 神はお休みになった

---

<Header>JavaScriptの歴史</Header>

---

<Header>1989: HTTP works !</Header>

<SplitRight>

"I just had to take the hypertext idea and connect it to the Transmission Control Protocol and domain name system ideas and—ta-da! —the World Wide Web" - Tim Berners-Lee

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Sir_Tim_Berners-Lee_%28cropped%29.jpg/440px-Sir_Tim_Berners-Lee_%28cropped%29.jpg" />

</SplitRight>

---

<Header>1995: JavaScript</Header>

<SplitRight>

"22 years ago in May I did 10 days of hard work. I didn’t sleep much." - Brandon Eich

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d1/Brendan_Eich_Mozilla_Foundation_official_photo.jpg/440px-Brendan_Eich_Mozilla_Foundation_official_photo.jpg" height="80vh" />

</SplitRight>

[thenewstack.io](https://thenewstack.io/brendan-eich-on-creating-javascript-in-10-days-and-what-hed-do-differently-today/)

---

<Header>1999: Ajax</Header>

<Split>

"It appeared as XMLHTTP in the second version of the MSXML library, which shipped with Internet Explorer 5.0 in March 1999 - wikipedia"

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/Jesse_James_Garrett_2016.jpg/400px-Jesse_James_Garrett_2016.jpg" />

</Split>

[A New Approach to Web Applications](https://immagic.com/eLibrary/ARCHIVES/GENERAL//ADTVPATH/A050218G.pdf)

---

<Header>1999: JSON</Header>

<Split>

"I do not claim to have invented JSON. It already existed in nature." - Douglas Crockford

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Douglas_Crockford%2C_February_2013.jpg/400px-Douglas_Crockford%2C_February_2013.jpg" />

</Split>

---
<Header>2004, 2005: AJAX</Header>

<Split>

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/48/GoogleMaps_logo.svg/140px-GoogleMaps_logo.svg.png" />

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ab/Gmail_Icon.svg/200px-Gmail_Icon.svg.png" />

</Split>

---

<Header>2006: ???</Header>

---

<Header>2006: jQuery</Header>

<Split>
	
<img src="https://upload.wikimedia.org/wikipedia/commons/c/cd/Jresig.png" />

```javascript
$("a").addClass("ok")
  .show("slow")
  .fadeOut(100)
```

</Split>

---

<Header>2008: V8 & Chrome</Header>

<Split>
	
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/V8_JavaScript_engine_logo_2.svg/440px-V8_JavaScript_engine_logo_2.svg.png" />

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Google_Chrome_icon_%28September_2014%29.svg/128px-Google_Chrome_icon_%28September_2014%29.svg.png" />

</Split>

---

<Header>2010: AngularJS(Google)</Header>

<img src="https://angular.io/assets/images/logos/angularjs/AngularJS-Shield.svg" />

---

<Header>2010: npm</Header>

<img src="https://raw.githubusercontent.com/npm/logos/master/npm%20logo/classic/npm-2009.png" />

```
npm install ...
```

---

<Header>2013: React(facebook)</Header>

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/React-icon.svg/500px-React-icon.svg.png" />

---

<Header>2014: Vue.js, babel(6to5)</Header>

<Split>

<img src="https://cdn-media-1.freecodecamp.org/images/0*xkJgg-6HskYrQ3N7.jpeg" />

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/Babel_Logo.svg/400px-Babel_Logo.svg.png" />

</Split>

---

<Header>2015: ECMAScript 6</Header>

- https://kangax.github.io/compat-table/es6/
- https://caniuse.com

---

<Header>2019: ??? </Header>

- pre 2019 trends: https://twitter.com/MikeRiethmuller/status/1147042962997563393?s=20
---

<Header>2019: Treasureのフロント講義</Header>

<Split>

<img src="https://user-images.githubusercontent.com/5494874/62817336-c60cc380-bb6f-11e9-8d8d-d5405e38cae0.jpg" width="400px" />

**JavaScriptを理解する人が30人増える**

</Split>

---

<Header>slideほしい？</Header>

---

<Header>JavaScriptおやおや#1:Type</Header>

```
1 + 1    // 2
1 + "1"  // "11"
{} + {}
[] + []
[] + {}
{} + []
```

- https://twitter.com/cdesio/status/1013166206877163520

---

<Header>JavaScriptおやおや#1:Type</Header>

```
// やらない
if (a) {}
if (a == true) {}

// ok
if (typeof a === "string") {}
if (a === true) {}
```

- use `===` over `==`

---

<Header>JavaScriptおやおや#1:Type（演習）</Header>

```
const condition = 5;
if (condition == "5") alert("!");
```

```
switch(condition) {
  case "5": alert("a");
  case 5: alert("b");
}
```
---

<Header>JavaScriptおやおや#2:グローバル関数</Header>

```
for (var i = 0; i < 5; i++){
  console.log(i)
}
console.log(i)
```
- A. 5
- B. ReferenceError: i is not defined
- C. 0

---

<Header>JavaScriptおやおや#2:グローバル関数</Header>

なにがおきった？

```
var i;
for (i = 0; i < 5; i++){
  console.log(i)
}
console.log(i)
```
---

<Header>エラーハンドリング</Header>

```
// 雑にやる
throw New Error("Oops...");

// ちゃんとやる
class MyError extends Error {}
throw New MyError("Oops...");
```
---

<Header>エラーハンドリング（演習）</Header>

- https://github.com/voyagegroup/treasure-javascript/tree/master/exercise/exception
- ヒント: `try...catch{}`
- PRを提出しましょう

---

<Header>Runtime</Header>

- [node](https://nodejs.org/docs/latest-v8.x/api/)
- **browser**
- ...

---

<Header>Browser</Header>

- https://caniuse.com

---
<Header>Event Loop</Header>

- JavaScriptはsingle thread
- Javascript Engineとのインターフェースは大体async
- Get off the main thread

---
<Header>Event Loopのブロック</Header>

- `window.alert()`はblock
- [sync `XMLHttpRequest`](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Synchronous_and_Asynchronous_Requests#Example_HTTP_synchronous_request)

```
var request = new XMLHttpRequest();
// `false` makes the request synchronous
request.open('GET', '/heavyRequest', false);
request.send();
```

---

<Header>Event Loopをブロックしないように</Header>

- https://github.com/voyagegroup/treasure-javascript/tree/master/exercise/block
- PRを待ってます

---

<Header>Async, defer script</Header>

<img src="https://www.growingwiththeweb.com/images/2014/02/26/async-vs-defer-twitter.png" />

* [Growing With The Web](https://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html)

---

<Header>Async, defer script</Header>

```
<script src="sync.js"></script>
<script src="async.js" async></script>
<script src="defer.js" defer></script>	
```
---

<Header>Async, defer script（演習）</Header>

以下の例sync, async, deferのどれ使った方が良いでしょうか。またそれはなぜ？

- SPAのJavaScript: https://github.com/voyagegroup/treasure-app/blob/master/frontend/index.html#L11
- 広告を表示させるためのJavaScriptタグ

---

<Header>Click Event</Header>

```javascript
<button id="clickMe">Click Me</button>
```
```
document.querySelector("#clickMe")
  .onclick = function(e) {}

document.querySelector("#clickMe")
  .addEventListener("click", function(e) {})
```

---

<Header>Event Propagation</Header>

```
       ----------------------------
      |            #o              |
      |     ----------------       |
      |    |                |      |
      |    |       #i       |      |
      |    |                |      |
      |     ----------------       |
       ----------------------------     
```

---

<Header>Event Propagation（演習）</Header>

- https://github.com/voyagegroup/treasure-javascript/tree/master/exercise/event
- PRを待ってます

---

<Header>SpeechRecognition Event（演習）</Header>

- https://github.com/voyagegroup/treasure-javascript/tree/master/exercise/speechrecognition
- PRを待ってます
- https://developer.mozilla.org/en-US/docs/Web/API/SpeechRecognition

---

<Header>テスト</Header>

- end to end
- integration
- snapshot
- unit
- static (lint)

---

<Header>テスト（演習）</Header>

- https://github.com/substack/tape
- https://github.com/voyagegroup/treasure-javascript/tree/master/exercise/debounce
- PRを待ってます

---

<Header>closure</Header>

- class vs clojure
- なんでclassを避けた方がいい？

---

<Header>Promiseについて</Header>

- https://promisesaplus.com

---

<Header>事前課題の振り返り: new Promise</Header>

```javascript
function request(url, method) {
  return new Promise((resolve, reject) => {
    fetch(url); 
  });
}
```

- https://github.com/VG-Tech-Dojo/treasure2019-pre/pull/200#issuecomment-518703698

---

<Header>事前課題の振り返り: new Promise</Header>

```javascript
function promisifiedXhr() {}
  return new Promise((resolve, reject) => {
        ...
        xhr.onload = () => { 
          resolve(xhr.responseText);
        };
        xhr.send();
  });
}
```

---

<Header>Promise</Header>

```
fetch("url").then(function(res) {
  // 1. return fetch(...)
  // 2. return res.json()
  // 3. throw new Error()
  // 4. side effect (UIを変えるとか)
})
```

---

<Header>よくないPromise</Header>

```
fetch("url").then(function(res) {
  if (res.ok) {
    return fetch(res.url).then(...);
  }
  throw new Error("...");
});
```

- [実例](https://github.com/blackberry/BB10-WebWorks-Community-Samples/blob/d6ee75fe23a10d2d3a036013b6b1a0c07a542099/pdbtest/www/js/index.js#L190-L220)

---

<Header>よいPromise</Header>

```
fetch("url").then(function(res) {
  if (res.ok) {
    return fetch(res.url);
  }
  throw new Error("...");
}).then(...);
```

- [実例](https://github.com/blackberry/BB10-WebWorks-Community-Samples/blob/d6ee75fe23a10d2d3a036013b6b1a0c07a542099/pdbtest/www/js/index.js#L190-L220)

---

<Header>Promise tips #1: Composition</Header>

```
fetch(function(res) {
  return res.json();
}).catch(function(error) {
  display(error);
});
```

---

<Header>Promise tips #1: Composition</Header>

```
function parseJson(res) { 
  return res.json();
}

fetch.then(parseJson).catch(display);
```

- [事前課題#1](https://github.com/VG-Tech-Dojo/treasure2019-pre/pull/75/files#diff-f58a1c1777a78f97fad303b5dd8e7e15R7-R28)

---

<Header>Promise tips #2: Catch last</Header>

```javascript
fetch.then(parseJson)
  .catch(display) // いらない
  .then(transform)
  .catch(display);
```

```javascript
fetch.then(parseJson)
  .then(transform)
  .catch(display)
```

---

<Header>Promise tips#3: all, race</Header>

- [Promise.race](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/race)
- [Promise.all](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all)

---

<Header>Fetch API（演習）</Header>

- https://github.com/voyagegroup/treasure-javascript/tree/master/exercise/fetch
- PRを待ってます

---

<Header>axios</Header>

- https://github.com/axios/axios

---

<Header>fetch vs axios</Header>

- どっちにする？

---

<Header>迷ったら苦しいミチを</Header>

![](https://user-images.githubusercontent.com/5494874/62994658-0635b400-be98-11e9-8828-7e1b9399d341.jpg)
---

Links
 - https://dev.to/steelvoltage/if-javascript-is-single-threaded-how-is-it-asynchronous-56gd
 - https://pouchdb.com/2015/05/18/we-have-a-problem-with-promises.html
